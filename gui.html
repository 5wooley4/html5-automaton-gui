<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
        background: black;
      }
      #container{background: white}
    </style>
  </head>
  <body>
    <div id="menu">
      <!-- Lauryns stuff here -->


    </div>
    <div id="container"></div>
    <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v4.7.1.min.js"></script>
    <!-- Our automiton library. -->
    <script src="lib/automiton.js"></script>
    <!-- Our Gestures Library. -->
    <script src="lib/canvas_gestures.js"></script>
    <!-- Our custom functions library -->
    <script src="lib/functions.js"></script>
    <!-- Because jquery is awesome http://api.jquery.com/ -->
    <script type="text/javascript" src="lib/jquery.min.js"></script>
    <!-- Underscore adds some convenient functions for javascript http://underscorejs.org/ -->
    <script src="lib/underscore-min.js"></script>

    <script defer="defer">
      // Start Automiton engine
      var aut = aut();
      // Adds an html5 canvas to container
      var stage = new Kinetic.Stage({
        container: 'container',
        width:$(document).width() - $("#menu").width(),
        height: $(document).height() - $("#menu").height()
      });

      // Layer to preview gestuers on.
      var gesture_preview = new Kinetic.Layer();

      // Layer to have touch events on.
      var touch_layer = new Kinetic.Layer();

      // Layer to draw our shapes
      var dfa_layer = new Kinetic.Layer();
      stage.add(dfa_layer);
      // an empty stage does not emit mouse-events
      // so fill the stage with a background rectangle
      // that can emit mouse-events
      var whiteboard = new Kinetic.Rect({
          x: 0,
          y: 0,
          width: stage.getWidth(),
          height: stage.getHeight(),
          //fill: 'green',
          stroke: 'black',
          strokeWidth: 1,
      });
      var states = [];
      var events = {
        circle: function(e){
          var circle = new Kinetic.Circle({
            x: e.center.x,
            y: e.center.y,
            radius: e.radius,
            fill: 'red',
            stroke: 'black',
            strokeWidth: 4
          });
          // This adds a node to circle for the engine to work with.
          var state = {circle: circle, node: aut.add_node()};
          dfa_layer.add(circle);
          dfa_layer.draw();
          console.log(JSON.stringify(e));
          states.push(state);

        },
        line: function(e){
          closest_object(e.start, states);


          var line = new Kinetic.Line({
            points: [e.start, e.end],
            stroke: 'red',
            strokeWidth: 5,
            lineCap: 'round',
            lineJoin: 'round'
          });
          dfa_layer.add(line);
          dfa_layer.draw();
        }
      };
      canvas_gestures({
        whiteboard: whiteboard,
        stage: stage,
        preview: gesture_preview,
        events: events
      }); 





      touch_layer.add(whiteboard);
      touch_layer.draw();




      stage.add(touch_layer);
      stage.add(gesture_preview);
    </script>
  </body>
</html>